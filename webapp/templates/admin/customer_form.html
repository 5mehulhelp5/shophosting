{% extends "admin/base_admin.html" %}

{% block title %}{% if customer %}Edit{% else %}Create{% endif %} Customer{% endblock %}
{% block page_title %}{% if customer %}Edit{% else %}Create{% endif %} Customer{% endblock %}

{% block content %}
<div style="max-width: 600px;">
    <a href="{{ url_for('admin.manage_customers') }}" class="btn btn-secondary btn-sm mb-4">Back to Manage Customers</a>

    <div class="card">
        <div class="card-header">
            <h3 class="card-title">{% if customer %}Edit Customer: {{ customer.email }}{% else %}New Customer{% endif %}</h3>
        </div>
        <div class="card-body">
            <form method="POST">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

                <div class="form-group">
                    <label for="email">Email *</label>
                    <input type="email" id="email" name="email" class="form-control" required
                           value="{{ customer.email if customer else '' }}"
                           placeholder="customer@example.com">
                </div>

                <div class="form-group">
                    <label for="password">Password {% if customer %}(leave blank to keep current){% else %}*{% endif %}</label>
                    <input type="password" id="password" name="password" class="form-control"
                           {% if not customer %}required{% endif %}
                           placeholder="{% if customer %}Enter new password{% else %}Enter password{% endif %}">
                </div>

                <div class="form-group">
                    <label for="company_name">Company Name *</label>
                    <input type="text" id="company_name" name="company_name" class="form-control" required
                           value="{{ customer.company_name if customer else '' }}"
                           placeholder="Acme Inc.">
                </div>

                <div class="form-group">
                    <label for="domain">Domain *</label>
                    <input type="text" id="domain" name="domain" class="form-control" required
                           value="{{ customer.domain if customer else '' }}"
                           placeholder="store.example.com">
                </div>

                <div class="form-group">
                    <label for="platform">Platform</label>
                    <select id="platform" name="platform" class="form-control">
                        <option value="woocommerce" {% if customer and customer.platform == 'woocommerce' %}selected{% endif %}>WooCommerce</option>
                        <option value="magento" {% if customer and customer.platform == 'magento' %}selected{% endif %}>Magento</option>
                    </select>
                </div>

                {% if not customer %}
                <div class="form-group">
                    <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                        <input type="checkbox" name="start_provisioning" checked style="width: 18px; height: 18px;">
                        <span>Start provisioning immediately</span>
                    </label>
                    <p class="text-muted" style="font-size: 0.85rem; margin-top: 6px;">
                        If checked, the customer's containers will be created automatically.
                    </p>
                </div>
                {% endif %}

                {% if customer %}
                <div class="form-group">
                    <label for="status">Status</label>
                    <select id="status" name="status" class="form-control">
                        <option value="pending" {% if customer.status == 'pending' %}selected{% endif %}>Pending</option>
                        <option value="pending_payment" {% if customer.status == 'pending_payment' %}selected{% endif %}>Pending Payment</option>
                        <option value="provisioning" {% if customer.status == 'provisioning' %}selected{% endif %}>Provisioning</option>
                        <option value="active" {% if customer.status == 'active' %}selected{% endif %}>Active</option>
                        <option value="suspended" {% if customer.status == 'suspended' %}selected{% endif %}>Suspended</option>
                        <option value="failed" {% if customer.status == 'failed' %}selected{% endif %}>Failed</option>
                    </select>
                </div>
                {% endif %}

                <div style="display: flex; gap: 12px; margin-top: 24px;">
                    <button type="submit" class="btn btn-primary">
                        {% if customer %}Update Customer{% else %}Create Customer{% endif %}
                    </button>
                    <a href="{{ url_for('admin.manage_customers') }}" class="btn btn-secondary">Cancel</a>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}
